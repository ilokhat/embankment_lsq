from shapely.wkt import loads
from shapes_and_geoms_stuff import get_points_talus
from triangulation import get_edges_from_triangulation
from displacer import LSDisplacer

roads = [('LineString(910262.60000000149011612 6327757.60000000149011612 704.60000000000582077, 910257.5 6327760.89999999850988388 706.10000000000582077, 910240.5 6327771.89999999850988388 708.5, 910229.29999999701976776 6327778.80000000074505806 710.19999999999708962, 910209 6327791.19999999925494194 713.39999999999417923, 910201.29999999701976776 6327796.10000000149011612 714.89999999999417923, 910195.60000000149011612 6327797.39999999850988388 715.5, 910193.70000000298023224 6327797.80000000074505806 715.80000000000291038, 910173.5 6327798.80000000074505806 719, 910159 6327799 720.69999999999708962, 910149.20000000298023224 6327799.5 721.80000000000291038, 910144.29999999701976776 6327801 721.80000000000291038, 910142.79999999701976776 6327807.69999999925494194 722.60000000000582077, 910142.79999999701976776 6327813.60000000149011612 720.10000000000582077)', 15 + 1.5),
('LineString(910193.60000000149011612 6327779.30000000074505806 713.89999999999417923, 910181.79999999701976776 6327772.89999999850988388 713.80000000000291038, 910164.79999999701976776 6327763.39999999850988388 712.89999999999417923, 910149.79999999701976776 6327756.19999999925494194 712.5, 910136.39999999850988388 6327749.5 712.10000000000582077, 910125.29999999701976776 6327743.39999999850988388 711.60000000000582077, 910119.39999999850988388 6327740 711.19999999999708962, 910115.79999999701976776 6327735.30000000074505806 711.10000000000582077, 910114.29999999701976776 6327729.80000000074505806 711.10000000000582077, 910114.5 6327724.60000000149011612 711, 910116.5 6327717.60000000149011612 710.5, 910122.70000000298023224 6327706.39999999850988388 710.30000000000291038, 910133.70000000298023224 6327689.30000000074505806 709.80000000000291038, 910147.20000000298023224 6327665.5 709)', 10 + 1),
('LineString(910296.29999999701976776 6327629 691.89999999999417923, 910285.39999999850988388 6327618.10000000149011612 692.39999999999417923, 910256.10000000149011612 6327586.30000000074505806 696.5, 910228.29999999701976776 6327556.19999999925494194 697.89999999999417923, 910209.29999999701976776 6327535.10000000149011612 699.39999999999417923, 910199.89999999850988388 6327526.19999999925494194 700.39999999999417923, 910195.10000000149011612 6327523 701.10000000000582077, 910190.60000000149011612 6327521.10000000149011612 701.39999999999417923, 910185.29999999701976776 6327520.5 701.5, 910181 6327520.80000000074505806 702.19999999999708962, 910176.70000000298023224 6327521.89999999850988388 702.19999999999708962, 910174.39999999850988388 6327523 702.19999999999708962, 910171 6327525.30000000074505806 702.19999999999708962, 910168.60000000149011612 6327528.5 702.19999999999708962, 910166.89999999850988388 6327532.30000000074505806 702.30000000000291038, 910165.70000000298023224 6327536.39999999850988388 702.80000000000291038, 910165.39999999850988388 6327541.80000000074505806 703.10000000000582077, 910165.70000000298023224 6327547.5 703.30000000000291038, 910166.60000000149011612 6327552.80000000074505806 703.5, 910169.79999999701976776 6327564.80000000074505806 704.19999999999708962, 910173.70000000298023224 6327577.69999999925494194 705.60000000000582077, 910178.10000000149011612 6327598.80000000074505806 707.39999999999417923, 910179.20000000298023224 6327607.80000000074505806 707.89999999999417923, 910178.70000000298023224 6327615.30000000074505806 708, 910178.39999999850988388 6327617.39999999850988388 708.10000000000582077, 910177 6327621.60000000149011612 708.10000000000582077, 910174.39999999850988388 6327624.80000000074505806 708.10000000000582077, 910169.89999999850988388 6327629.80000000074505806 708.30000000000291038, 910154.29999999701976776 6327644.80000000074505806 709, 910150.89999999850988388 6327650.60000000149011612 709, 910148.70000000298023224 6327656.89999999850988388 709, 910147.20000000298023224 6327665.5 709)', 20 + 2)
]

talus = ['LineString(910102.29999999701976776 6327746.30000000074505806 712.39999999999417923, 910113.39999999850988388 6327770.60000000149011612 718.69999999999708962, 910121.70000000298023224 6327780.39999999850988388 720.60000000000582077, 910131.79999999701976776 6327787.60000000149011612 721.39999999999417923, 910142.39999999850988388 6327791.89999999850988388 721.69999999999708962, 910155 6327794.39999999850988388 720.80000000000291038, 910170.20000000298023224 6327794.69999999925494194 718.60000000000582077, 910192.10000000149011612 6327792 715.19999999999708962)',
'LineString(910098.5 6327738.89999999850988388 710.30000000000291038, 910110 6327715.39999999850988388 710.19999999999708962, 910118.70000000298023224 6327693.39999999850988388 709.30000000000291038, 910131.20000000298023224 6327661.60000000149011612 708.30000000000291038, 910135.5 6327638.10000000149011612 706.69999999999708962, 910138.70000000298023224 6327617.30000000074505806 705.89999999999417923, 910138 6327609.19999999925494194 701.80000000000291038)',
'LineString(910168.20000000298023224 6327579.80000000074505806 705.89999999999417923, 910163.60000000149011612 6327564.89999999850988388 704.30000000000291038, 910160.5 6327554.5 703.80000000000291038, 910159.39999999850988388 6327545.19999999925494194 703.30000000000291038, 910159.89999999850988388 6327535.5 702.80000000000291038, 910162.60000000149011612 6327528 702.19999999999708962, 910166.10000000149011612 6327521.80000000074505806 702.19999999999708962, 910172.70000000298023224 6327515.69999999925494194 701.69999999999708962, 910179.20000000298023224 6327512.5 701.30000000000291038, 910186.39999999850988388 6327512.69999999925494194 701.19999999999708962, 910193.39999999850988388 6327515.19999999925494194 701.19999999999708962, 910201.10000000149011612 6327519.60000000149011612 700.60000000000582077, 910219.29999999701976776 6327538.89999999850988388 699.69999999999708962, 910255 6327576.39999999850988388 696.60000000000582077, 910285.89999999850988388 6327609.19999999925494194 694.39999999999417923)'
]


talus_shapes = [loads(t) for t in talus]
talus_lengths = [len(t.coords) for t in talus_shapes]

points_talus = get_points_talus(talus_shapes)
edges = get_edges_from_triangulation(points_talus, talus_lengths)

LSDisplacer.set_params(MAX_ITER=1000, NORM_DX=0.3,
                       PFix=8.0, PDistRoads=200,
                       PAngles=8, PEdges_ext=15, Pedges_ext_far=0.5, PEdges_int=1, PEdges_int_non_seg=1)

displacer = LSDisplacer(points_talus, roads, talus_lengths, edges)
print("P matrix size", displacer.P.shape)
displacer.square()
displacer.print_linestrings_wkts()
